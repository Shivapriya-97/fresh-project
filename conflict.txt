This is edited from master branch.
